# テスト計画書

## 1. テスト概要

### 1.1 目的
本プロジェクトの品質を担保するため、各種テストを実施する。

### 1.2 テスト範囲

| 対象 | テスト種別 |
|------|-----------|
| バックエンドAPI | ユニットテスト、E2Eテスト |
| フロントエンド | (未実装) |
| インフラ | 手動テスト |

---

## 2. テスト環境

| 環境 | 用途 |
|------|------|
| ローカル | 開発中のテスト実行 |
| CI (GitHub Actions) | PR時の自動テスト |

---

## 3. テスト種別

### 3.1 ユニットテスト

**対象**: Service層

**ツール**: Jest

**実行コマンド**:
```bash
npm run test
```

**カバレッジ目標**: 主要機能の80%以上

---

### 3.2 E2Eテスト

**対象**: APIエンドポイント

**ツール**: Jest + Supertest

**実行コマンド**:
```bash
npm run test:e2e
```

---

## 4. テストケース

### 4.1 認証 (auth)

| ID | テストケース | 期待結果 |
|----|-------------|----------|
| AUTH-001 | 正しい認証情報でログイン | JWTトークンが返却される |
| AUTH-002 | 不正なパスワードでログイン | 401エラーが返却される |
| AUTH-003 | 存在しないメールでログイン | 401エラーが返却される |
| AUTH-004 | パスワードなしでログイン | 400エラーが返却される |
| AUTH-005 | Google認証コールバック | ユーザー作成/ログイン成功 |

---

### 4.2 ユーザー (users)

| ID | テストケース | 期待結果 |
|----|-------------|----------|
| USER-001 | 正しい情報で新規登録 | ユーザーが作成される |
| USER-002 | 重複メールで新規登録 | 409エラーが返却される |
| USER-003 | 不正なメール形式で登録 | 400エラーが返却される |
| USER-004 | 短すぎるパスワードで登録 | 400エラーが返却される |
| USER-005 | ユーザー情報取得 | ユーザー情報が返却される |
| USER-006 | 存在しないユーザー取得 | 404エラーが返却される |
| USER-007 | プロフィール更新 | 更新されたユーザー情報が返却される |
| USER-008 | 未認証でプロフィール更新 | 401エラーが返却される |

---

### 4.3 投稿 (posts)

| ID | テストケース | 期待結果 |
|----|-------------|----------|
| POST-001 | 投稿一覧取得 | 公開投稿の一覧が返却される |
| POST-002 | 投稿詳細取得 | 投稿詳細が返却される |
| POST-003 | 存在しない投稿取得 | 404エラーが返却される |
| POST-004 | 認証済みで投稿作成 | 投稿が作成される |
| POST-005 | 未認証で投稿作成 | 401エラーが返却される |
| POST-006 | タイトルなしで投稿作成 | 400エラーが返却される |
| POST-007 | 投稿者本人が投稿編集 | 投稿が更新される |
| POST-008 | 他人の投稿を編集 | 403エラーが返却される |
| POST-009 | 投稿者本人が投稿削除 | 投稿が削除される |
| POST-010 | 他人の投稿を削除 | 403エラーが返却される |
| POST-011 | キーワードで検索 | 該当投稿が返却される |
| POST-012 | タグで検索 | 該当投稿が返却される |
| POST-013 | タグ付きで投稿作成 | 投稿とタグが作成される |
| POST-014 | 位置情報付きで投稿作成 | 投稿と位置情報が作成される |

---

### 4.4 フォロー (follows)

| ID | テストケース | 期待結果 |
|----|-------------|----------|
| FOLLOW-001 | ユーザーをフォロー | フォロー関係が作成される |
| FOLLOW-002 | 自分自身をフォロー | 400エラーが返却される |
| FOLLOW-003 | 既にフォロー済みのユーザーをフォロー | 409エラーが返却される |
| FOLLOW-004 | フォロー解除 | フォロー関係が削除される |
| FOLLOW-005 | フォローしていないユーザーを解除 | 404エラーが返却される |
| FOLLOW-006 | フォロワー一覧取得 | フォロワーリストが返却される |
| FOLLOW-007 | フォロー中一覧取得 | フォロー中リストが返却される |
| FOLLOW-008 | フォロー状態確認 | isFollowing が返却される |

---

### 4.5 ブックマーク (favorites)

| ID | テストケース | 期待結果 |
|----|-------------|----------|
| FAV-001 | 投稿をブックマーク | ブックマークが作成される |
| FAV-002 | 既にブックマーク済みの投稿をブックマーク | 409エラーが返却される |
| FAV-003 | ブックマーク解除 | ブックマークが削除される |
| FAV-004 | ブックマークしていない投稿を解除 | 404エラーが返却される |
| FAV-005 | ブックマーク一覧取得 | ブックマークリストが返却される |
| FAV-006 | 未認証でブックマーク | 401エラーが返却される |

---

## 5. テスト実行結果

### 5.1 ユニットテスト

| モジュール | テスト数 | 成功 | 失敗 | カバレッジ |
|-----------|---------|------|------|-----------|
| auth.service | - | - | - | - |
| users.service | - | - | - | - |
| posts.service | - | - | - | - |
| follows.service | - | - | - | - |
| favorites.service | - | - | - | - |

### 5.2 E2Eテスト

| モジュール | テスト数 | 成功 | 失敗 |
|-----------|---------|------|------|
| auth | - | - | - |
| users | - | - | - |
| posts | - | - | - |
| follows | - | - | - |
| favorites | - | - | - |

---

## 6. CI/CD統合

### 6.1 GitHub Actions

```yaml
# PRマージ時に実行
- npm run lint
- npm run test
- npm run build
```

### 6.2 テスト失敗時の対応

1. CIが失敗した場合、PRはマージ不可
2. テスト失敗の原因を調査・修正
3. 修正後、再度PRを作成

---

## 7. 今後の改善点

| 項目 | 内容 |
|------|------|
| フロントエンドテスト | Jest + React Testing Library導入 |
| カバレッジレポート | codecov等でカバレッジ可視化 |
| パフォーマンステスト | 負荷テストツール導入 |
| セキュリティテスト | OWASP ZAP等でスキャン |
